<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Page</title>
    <link rel="stylesheet" type="text/css" href="logIn.css">
    <script src="https://www.gstatic.com/firebasejs/7.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.10.0/firebase-firestore.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <style>
        /* Remove the navbar's default margin-bottom and rounded borders */
        .navbar {
            margin-bottom: 0;
            border-radius: 0;
            background-color: #28322C;
            border-color: #28322C;
        }

        /* The Modal (background) */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            padding-top: 100px;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
        }

        /* Modal Content */
        .modal-content {
            background-color: #28322C;
            color: white;
            text-align: justify;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

        /* The Close Button */
        .close {
            color: lightgreen;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: white;
            text-decoration: none;
            cursor: pointer;
        }
        #examButton{
            border-radius: 20px;
            text-align: center;
            left: 220px;
            font-size: 20px;
            width: 120px;
            height: 40px;
            outline: none;
        }
        #examModalId{
            display: none;
            position: fixed;
            z-index: 1;
            padding-top: 100px;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0, 0, 0);
            background-color: rgba(0, 0, 0, 0.4);
        }
        .examModal-content{
            background-color: #28322C;
            color: white;
            text-align: justify;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }
        .button-container{
            position: relative;
            left: 550px;
            text-align: center;
            width:160px;
        }
        .calendar-container{
            position:relative;
            top:-280px;
            left:900px;
            font-size:20px;
            border:solid 1px rgb(220, 220, 220);
            text-align:center;
            width:265px;
        }
        .calendar-table{
            margin-left:30px;
            margin-bottom:20px;
        }
        button{
            border-radius: 20px;
            font-size: 20px;
            width: 120px;
            height: 40px;
            outline: none;

        }
        th{
            border:solid 2px black;
        }
        #time-container{
            position:relative;
            text-align:center;
            top:-650px;
            left:20px;
            border:solid 1px rgb(220, 220, 220);
            border-radius:10px;
            width:100px;
            height:25px;
            font-size:20px;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">Higher Exam</a>
            </div>
            <div class="collapse navbar-collapse" id="myNavbar">
                <ul class="nav navbar-nav navbar-right">
                    <li id='logout'><a href="index.html">Home</a></li>
                    <li id='modalBtn'><a>Account Info</a></li>
                    <li id='logout'><a href='logIn.html'><span class="glyphicon glyphicon-log-in"></span> Sign Out</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <div class="jumbotron">
        <div class="container text-center">
            <h1 id='username'>Welcome </h1>
            <p id="welcomeMessage">error on welcome message</p>
        </div>
    </div>

    <div class="container-fluid text-center">
        <div class="row content">
            
            <div class="col-sm-8 text-left button-container">

                <!--show tests button-->
                <button id="examButton">Your Tests</button>
               
                <div id="examModalId">

                    <!-- Exam modal content -->
                    <div class="examModal-content">
                        <span class="close">&times;</span>
                        <h3>Here are your exam details:</h3>
                        <!--FOR ALEX Link names will come from examiner DB along with Due dates-->
                        <p id='examDetails'><a href="studentPageResource/startExam.php?examid=1">Software Engineering</a> Due: 03/04/2020</p>
                        <p id='examDetails'><a href="studentPageResource/startExam.php?examid=1">Business Modelling</a> Due: 26/05/2020</p>
                        <p id='examDetails'><a href="studentPageResource/startExam.php?examid=1">Procedural Programming</a> Due: 02/04/2020</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--Notice dropbox-->
    <div style="position: relative;top:30px; left:20px; border: solid 1px rgb(220, 220, 220);border-radius: 10px; width:500px;">
        <h4>Exam Code of Conduct</h4>
        <!--This can be changed, remember to ask if it should come from examiner or have just one form of it.-->
        <p>Possession of unauthorised material at any time when under examination conditions is an
            assessment offence and can lead to expulsion from the institution. Check now to ensure you do not have
            any notes, mobile phones or unauthorised electronic devices on your person. If you do, raise your
            hand and give them to an invigilator immediately. It is also an offence to have any writing of any
            kind on your person, including on your body. If you are found to have hidden unauthorised material
            elsewhere, including toilets and cloakrooms it will be treated as being found in your possession.
            Unauthorised material found on your mobile phone or other electronic device will be considered
            the same as being in possession of paper notes. A mobile phone that causes a disruption in the
            exam is also an assessment offence.</p>
    </div>
    <!--Examiners coming from DB-->
    <div style="position:relative;top:-300px;left:800px;width:400px;border:solid 1px rgb(220, 220, 220); border-radius: 10px;">
        <p><h4>Examiners: </h4></p>
    </div>
    <!-- The Modal -->
    <div id="myModal" class="modal">

        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>Here are your account details:</h3>
            <p id='accountDetails'></p>
        </div>

    </div>

    <div class="calendar-container" style="border-radius: 10px;">
        <div class="card">
            <h3 class="month-and-year-holder" id="monthAndYear"></h3>
            <table class="calendar-table" id="calendar">
                <thead>
                <tr>
                    <th>Sun</th>
                    <th>Mon</th>
                    <th>Tue</th>
                    <th>Wed</th>
                    <th>Thu</th>
                    <th>Fri</th>
                    <th>Sat</th>
                </tr>
                </thead>
    
                <tbody id="calendar-body">
    
                </tbody>
            </table>
    
            <div class="previous-and-next-container">
    
                <button  id="previous" onclick="previous()">Previous</button>
    
                <button id="next" onclick="next()">Next</button>
            </div>
            <br/>
            <form class="change-month-class">
                <label for="month">Change Month:</label>
                <select name="month" id="month" onchange="jump()">
                    <option value=0>Jan</option>
                    <option value=1>Feb</option>
                    <option value=2>Mar</option>
                    <option value=3>Apr</option>
                    <option value=4>May</option>
                    <option value=5>Jun</option>
                    <option value=6>Jul</option>
                    <option value=7>Aug</option>
                    <option value=8>Sep</option>
                    <option value=9>Oct</option>
                    <option value=10>Nov</option>
                    <option value=11>Dec</option>
                </select>
    
    
                <label for="year"></label><select name="year" id="year" onchange="jump()">
                <option value=1990>1990</option>
                <option value=1991>1991</option>
                <option value=1992>1992</option>
                <option value=1993>1993</option>
                <option value=1994>1994</option>
                <option value=1995>1995</option>
                <option value=1996>1996</option>
                <option value=1997>1997</option>
                <option value=1998>1998</option>
                <option value=1999>1999</option>
                <option value=2000>2000</option>
                <option value=2001>2001</option>
                <option value=2002>2002</option>
                <option value=2003>2003</option>
                <option value=2004>2004</option>
                <option value=2005>2005</option>
                <option value=2006>2006</option>
                <option value=2007>2007</option>
                <option value=2008>2008</option>
                <option value=2009>2009</option>
                <option value=2010>2010</option>
                <option value=2011>2011</option>
                <option value=2012>2012</option>
                <option value=2013>2013</option>
                <option value=2014>2014</option>
                <option value=2015>2015</option>
                <option value=2016>2016</option>
                <option value=2017>2017</option>
                <option value=2018>2018</option>
                <option value=2019>2019</option>
                <option value=2020>2020</option>
                <option value=2021>2021</option>
                <option value=2022>2022</option>
                <option value=2023>2023</option>
                <option value=2024>2024</option>
                <option value=2025>2025</option>
                <option value=2026>2026</option>
                <option value=2027>2027</option>
                <option value=2028>2028</option>
                <option value=2029>2029</option>
                <option value=2030>2030</option>
            </select></form>
        </div>
    </div>
<!--adding time tag-->
    <div id="time-container" >
        <p id="output"></p>
    </div>
    <script name="time js">
        function showTime(){
  var time = new Date();
   var   currentH =  time.getHours();
  //setting hour to 24hr clock
      if(currentH < 12){
        currentH =  "0"+currentH;
      var f =  document.getElementById("output").innerHTML = currentH;
      }
  // adding "0" before 10minute mark
  var currentM = time.getMinutes();
      if(currentM <10){
        currentM = "0"+currentM;
        document.getElementById("output").innerHTML = currentH + " : " + currentM;
      }else{
        document.getElementById("output").innerHTML = currentH + " : " + currentM;
      }    
}
window.addEventListener("load", function(){
  setInterval(showTime, 1000)
});
    </script>
    <script name="calendar">
        d = new Date();
currentMonth = d.getMonth();
currentYear = d.getFullYear();
selectYear = document.getElementById("year");
selectMonth = document.getElementById("month");

months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

monthAndYear = document.getElementById("monthAndYear");
showCalendar(currentMonth, currentYear);


function next() {
    currentYear = (currentMonth === 11) ? currentYear + 1 : currentYear;
    currentMonth = (currentMonth + 1) % 12;
    showCalendar(currentMonth, currentYear);
}

function previous() {
    currentYear = (currentMonth === 0) ? currentYear - 1 : currentYear;
    currentMonth = (currentMonth === 0) ? 11 : currentMonth - 1;
    showCalendar(currentMonth, currentYear);
}

function jump() {
    currentYear = parseInt(selectYear.value);
    currentMonth = parseInt(selectMonth.value);
    showCalendar(currentMonth, currentYear);
}

function showCalendar(month, year) {

    let firstDay = (new Date(year, month)).getDay();

    tbl = document.getElementById("calendar-body"); // body of the calendar

    // clearing all previous cells
    tbl.innerHTML = "";

    // filing data about month and in the page via DOM.
    monthAndYear.innerHTML = months[month] + " " + year;
    selectYear.value = year;
    selectMonth.value = month;

    // creating all cells
    let date = 1;
    for (let i = 0; i < 6; i++) {
        // creates a table row
        let row = document.createElement("tr");

        //creating individual cells, filling them up with data.
        for (let j = 0; j < 7; j++) {
            if (i === 0 && j < firstDay) {
                cell = document.createElement("td");
                cellText = document.createTextNode("");
                cell.appendChild(cellText);
                row.appendChild(cell);
            }
            else if (date > daysInMonth(month, year)) {
                break;
            }

            else {
                cell = document.createElement("td");
                cellText = document.createTextNode(date);
                if (date === d.getDate() && year === d.getFullYear() && month === d.getMonth()) {
                   
                } // color today's date
                cell.appendChild(cellText);
                row.appendChild(cell);
                date++;
            }


        }

        tbl.appendChild(row); // appending each row into calendar body.
    }

}


// check days in a month code from 
function daysInMonth(iMonth, iYear) {
    return 32 - new Date(iYear, iMonth, 32).getDate();
}

    </script>

    <script src="https://www.gstatic.com/firebasejs/5.6.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.6.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.6.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.6.0/firebase-functions.js"></script>
    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyDiUrWvr_XfF3o-YVinV_D9JuKXJpWbPaI",
            authDomain: "examination-system-f53f3.firebaseapp.com",
            databaseURL: "https://examination-system-f53f3.firebaseio.com",
            projectId: "examination-system-f53f3",

        };
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        // maek auth and firestore references
        const auth = firebase.auth();
        const db = firebase.firestore();
        const functions = firebase.functions();

        //update firestore settings
        db.settings({ timestampsInSnapshots: true });



    </script>

    <script>
        //log out 
        const logout = document.querySelector('#logout');
        logout.addEventListener('click', (e) => {
            e.preventDefault();
            auth.signOut().then(() => {
                alert('User signed out')
            })
        });
        const accountDetails = document.querySelector('.accountDetails');
        // for some reason, user is logged in from the start
        //listen for the auth status of user (whether they're signed in or out)
        auth.onAuthStateChanged(user => {
            if (user) {
                user.getIdTokenResult().then(idTokenResult => {
                    user.admin = idTokenResult.claims.admin
                    setupUI(user);
                })
                console.log('User logged in: ', user)

            } else {
                console.log('User logged out');
                location.replace('index.html');
            }
        });
        

        const adminItems = document.querySelectorAll('.adminOnly');
        const setupUI = (user) => {
            //<div>password: ${doc.data().password} </div>
            if (user) {
                
                //acount info 
                db.collection('users').doc(user.uid).get().then(doc => {
                    const name = `<span>${doc.data().username}</span>`;
                    const html = `
                <div>email: ${user.email} </div>
                <div>username: ${doc.data().username} </div>
                <div>user level: ${doc.data().userLevel} </div>
                `;
                    document.getElementById('accountDetails').innerHTML += html;
                    document.getElementById('username').innerHTML += name;
                //FOR ALEX Mention number of exams to do and a little message for the student, NOTE: number and date variable will come from the examiner database
                    var welcomeMessage = "You have " + "3" + " exams to attempt by " + "20/06/2020"+"." ;
                    document.getElementById('welcomeMessage').innerHTML = welcomeMessage;
                });
                
            }
            else {
                for (i = 0; i < adminItems.length; i++) {
                    adminItems[i].style.display = 'none';
                }
                accountDetails.innerHtml = '';
                document.getElementById('username').innerHTML
            }
        }


        // Get the modal
        var modal = document.getElementById("myModal");
        // Get the button that opens the modal
        var btn = document.getElementById("modalBtn");
        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];
        btn.onclick = function () {
            modal.style.display = "block";
        }
        span.onclick = function () {
            modal.style.display = "none";
        }
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    </script>
    <script>
        
        /*var checkExams = document.getElementById("examButton");
        var examModal = document.getElementById('examModalId');
        var examSpan = document.getElementsByClassName('close')[0];
        checkExams.onclick = function(){
            examModal.style.display = "block";
        }
        examSpan.onclick = function () {
            examModal.style.display = "none";
        }
        window.onclick = function (event) {
            if (event.target == examModal) {
                examModal.style.display = "none";
            }
        }*/

    </script>

</body>

</html>
